# Test script with program loading

# Machine 1 Setup
mach create "machine1"
machine LoadPlatformDescription @simple_platform.repl

# Load test program
sysbus LoadELF @test.elf

# Machine 2 Setup  
mach create "machine2"
machine LoadPlatformDescription @simple_platform.repl

# Create UART Hub for inter-machine communication
emulation CreateUARTHub "uart_hub"

# Connect machine1 UART1 to hub
mach set "machine1"
connector Connect sysbus.uart1 uart_hub

# Connect machine2 UART1 to hub
mach set "machine2"
connector Connect sysbus.uart1 uart_hub

# Set up analyzers to see UART output
mach set "machine1"
showAnalyzer sysbus.uart0
showAnalyzer sysbus.uart1

mach set "machine2"
showAnalyzer sysbus.uart0
showAnalyzer sysbus.uart1

echo "Setup complete. Type 'start' to run"
